<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OK VIP Users</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #f5f7fa;
            min-height: 100vh;
            padding: 15px;
            color: #333;
            font-size: 14px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        /* Compact Header */
        .compact-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 15px;
            text-align: center;
        }

        .title-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .logo-small {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-small i {
            font-size: 16px;
            color: white;
        }

        .compact-title {
            font-size: 22px;
            font-weight: 700;
            line-height: 1.2;
        }

        .title-lines {
            text-align: left;
        }

        .title-line {
            font-size: 18px;
            font-weight: 600;
        }

        .subtitle-small {
            font-size: 13px;
            opacity: 0.9;
            margin-top: 5px;
        }

        /* Compact Stats - Inline */
        .compact-stats {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 15px 0;
            padding: 0 15px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 70px;
        }

        .stat-value-small {
            font-size: 28px;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 5px;
        }

        .stat-label-small {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.9);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .total-stat .stat-value-small { color: #fff; }
        .active-stat .stat-value-small { color: #4ade80; }
        .inactive-stat .stat-value-small { color: #f87171; }

        /* Divider */
        .divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.2);
            margin: 15px 20px;
        }

        /* Main Content - Compact */
        .compact-content {
            padding: 20px 15px;
        }

        /* Search Box - Compact */
        .search-container-small {
            margin-bottom: 20px;
        }

        .search-box-small {
            position: relative;
        }

        .search-box-small i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #667eea;
            font-size: 16px;
        }

        .search-box-small input {
            width: 100%;
            padding: 12px 15px 12px 45px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            background: #f8fafc;
        }

        .search-box-small input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
        }

        /* Users List - Compact */
        .compact-users-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .user-item {
            background: #f8fafc;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
            transition: all 0.2s;
        }

        .user-item:hover {
            background: #f1f5f9;
            transform: translateX(3px);
        }

        .user-item.active {
            border-left-color: #4ade80;
            background: #f0fdf4;
        }

        .user-item.inactive {
            border-left-color: #f87171;
            background: #fef2f2;
        }

        .user-header-small {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .user-name {
            font-weight: 600;
            color: #1e293b;
            font-size: 15px;
        }

        .user-status-small {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-active-small {
            background: #dcfce7;
            color: #16a34a;
        }

        .status-inactive-small {
            background: #fee2e2;
            color: #dc2626;
        }

        .user-details-small {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 13px;
        }

        .detail-row {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #64748b;
        }

        .detail-row i {
            color: #667eea;
            font-size: 14px;
            width: 16px;
            text-align: center;
        }

        .detail-label {
            font-weight: 500;
            color: #475569;
        }

        .detail-value {
            font-weight: 600;
            color: #1e293b;
        }

        /* Add Button - Compact */
        .btn-add-small {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            width: 100%;
            padding: 14px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-add-small:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* Empty State - Compact */
        .empty-state-small {
            text-align: center;
            padding: 40px 20px;
            color: #94a3b8;
        }

        .empty-state-small i {
            font-size: 40px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-state-small h3 {
            font-size: 16px;
            color: #475569;
            margin-bottom: 8px;
        }

        /* Form - Compact */
        .form-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1000;
        }

        .form-modal {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .form-header-small {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .form-header-small h3 {
            font-size: 18px;
            font-weight: 600;
        }

        .btn-close {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .form-body {
            padding: 20px;
        }

        .form-group-small {
            margin-bottom: 18px;
        }

        .form-group-small label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #475569;
        }

        .form-input-small {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            background: #f8fafc;
        }

        .form-input-small:focus {
            outline: none;
            border-color: #667eea;
            background: white;
        }

        .switch-group-small {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .switch-small {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }

        .switch-small input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider-small {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .4s;
            border-radius: 34px;
        }

        .slider-small:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider-small {
            background-color: #4ade80;
        }

        input:checked + .slider-small:before {
            transform: translateX(22px);
        }

        .form-actions-small {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 25px;
        }

        .btn-form-small {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-form-small:hover {
            opacity: 0.9;
        }

        .btn-add-form {
            background: #4ade80;
            color: white;
        }

        .btn-update-form {
            background: #667eea;
            color: white;
        }

        .btn-delete-form {
            background: #f87171;
            color: white;
        }

        /* Notification - Compact */
        .notification-small {
            position: fixed;
            bottom: 20px;
            right: 20px;
            left: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 400px;
            margin: 0 auto;
        }

        .notification-small.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification-small.success {
            background: #4ade80;
        }

        .notification-small.error {
            background: #f87171;
        }

        .notification-small.info {
            background: #667eea;
        }

        /* Loading */
        .loading-small {
            text-align: center;
            padding: 30px;
            color: #94a3b8;
        }

        .loading-spinner-small {
            border: 3px solid #f1f5f9;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        /* Footer - Compact */
        .footer-small {
            text-align: center;
            padding: 15px;
            color: #94a3b8;
            font-size: 12px;
            border-top: 1px solid #f1f5f9;
        }

        /* Demo Data Badge */
        .demo-badge {
            display: inline-block;
            background: #fef3c7;
            color: #92400e;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 480px) {
            .compact-title {
                font-size: 20px;
            }
            
            .title-line {
                font-size: 16px;
            }
            
            .stat-value-small {
                font-size: 24px;
            }
            
            .compact-stats {
                gap: 20px;
            }
        }

        @media (min-width: 768px) {
            .container {
                max-width: 500px;
                margin: 20px auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Compact Header -->
        <div class="compact-header">
            <div class="title-row">
                <div class="logo-small">
                    <i class="fas fa-users-cog"></i>
                </div>
                <div class="title-lines">
                    <div class="compact-title">
                        <div class="title-line">Firebase</div>
                        <div class="title-line">Users Manager</div>
                    </div>
                </div>
            </div>
            
            <p class="subtitle-small">Manage VIP users in real-time</p>
            
            <!-- Compact Stats - One Row -->
            <div class="compact-stats">
                <div class="stat-item total-stat">
                    <div class="stat-value-small" id="totalUsers">4</div>
                    <div class="stat-label-small">Total</div>
                </div>
                <div class="stat-item active-stat">
                    <div class="stat-value-small" id="activeUsers">3</div>
                    <div class="stat-label-small">Active</div>
                </div>
                <div class="stat-item inactive-stat">
                    <div class="stat-value-small" id="inactiveUsers">1</div>
                    <div class="stat-label-small">Inactive</div>
                </div>
            </div>
            
            <div class="demo-badge">Demo Data</div>
        </div>

        <!-- Divider -->
        <div class="divider"></div>

        <!-- Main Content -->
        <div class="compact-content">
            <div class="search-container-small">
                <div class="search-box-small">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search users...">
                </div>
            </div>

            <div class="compact-users-list" id="usersList">
                <div class="loading-small">
                    <div class="loading-spinner-small"></div>
                    <p>Loading users...</p>
                </div>
            </div>

            <button class="btn-add-small" id="openForm">
                <i class="fas fa-plus-circle"></i> Add New User
            </button>
        </div>

        <!-- Footer -->
        <div class="footer-small">
            <p>OK VIP Users Management ‚Ä¢ Firebase</p>
        </div>
    </div>

    <!-- Form Modal -->
    <div class="form-overlay" id="formOverlay">
        <div class="form-modal">
            <div class="form-header-small">
                <h3><i class="fas fa-user-edit"></i> User Form</h3>
                <button class="btn-close" id="closeForm">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="form-body">
                <div class="form-group-small">
                    <label for="token">Token *</label>
                    <input type="text" id="token" class="form-input-small" placeholder="Enter token">
                </div>
                
                <div class="form-group-small">
                    <label for="username">Username</label>
                    <input type="text" id="username" class="form-input-small" placeholder="Enter username">
                </div>
                
                <div class="form-group-small">
                    <label for="expiry">Expiry Date</label>
                    <input type="text" id="expiry" class="form-input-small" placeholder="YYYY-MM-DD">
                </div>
                
                <div class="form-group-small">
                    <div class="switch-group-small">
                        <span>Active Status</span>
                        <label class="switch-small">
                            <input type="checkbox" id="isActive" checked>
                            <span class="slider-small"></span>
                        </label>
                    </div>
                </div>
                
                <div class="form-actions-small">
                    <button class="btn-form-small btn-add-form" id="btnAdd">
                        <i class="fas fa-plus"></i> Add
                    </button>
                    <button class="btn-form-small btn-update-form" id="btnUpdate">
                        <i class="fas fa-sync"></i> Update
                    </button>
                    <button class="btn-form-small btn-delete-form" id="btnDelete">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification-small" id="notification"></div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCeHjHJrNEtOjeC8haVcAxVQCQqL22GbS0",
            authDomain: "jkvip-58a69.firebaseapp.com",
            projectId: "jkvip-58a69",
            storageBucket: "jkvip-58a69.appspot.com",
            messagingSenderId: "675812875324",
            appId: "1:675812875324:android:2eda82c5819fdba9f37739"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Global variables
        let allUsers = [];
        let filteredUsers = [];
        let currentEditToken = null;

        // DOM Elements
        const formOverlay = document.getElementById('formOverlay');
        const openFormBtn = document.getElementById('openForm');
        const closeFormBtn = document.getElementById('closeForm');
        const searchInput = document.getElementById('searchInput');
        const usersList = document.getElementById('usersList');
        const notification = document.getElementById('notification');

        // Form elements
        const tokenInput = document.getElementById('token');
        const usernameInput = document.getElementById('username');
        const expiryInput = document.getElementById('expiry');
        const isActiveInput = document.getElementById('isActive');
        const btnAdd = document.getElementById('btnAdd');
        const btnUpdate = document.getElementById('btnUpdate');
        const btnDelete = document.getElementById('btnDelete');

        // Stats elements
        const totalUsersEl = document.getElementById('totalUsers');
        const activeUsersEl = document.getElementById('activeUsers');
        const inactiveUsersEl = document.getElementById('inactiveUsers');

        // Demo data (from your image)
        const demoUsers = [
            {
                token: "AyeNyin",
                username: "AyeNyin",
                expiryDate: "2026-2-24",
                isActive: true,
                remainingDays: "38 days"
            },
            {
                token: "root",
                username: "root",
                expiryDate: "2026-2-23",
                isActive: true,
                remainingDays: "37 days"
            },
            {
                token: "min",
                username: "min",
                expiryDate: "2026.5.4",
                isActive: true,
                remainingDays: "Unknown"
            },
            {
                token: "inactive_user",
                username: "Unknown",
                expiryDate: null,
                isActive: false,
                remainingDays: "Unknown"
            }
        ];

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Set initial demo stats
            updateCounters(4, 3, 1);
            renderDemoUsers();
            
            openFormBtn.addEventListener('click', openForm);
            closeFormBtn.addEventListener('click', closeForm);
            btnAdd.addEventListener('click', addUser);
            btnUpdate.addEventListener('click', updateUser);
            btnDelete.addEventListener('click', deleteUser);
            searchInput.addEventListener('input', filterUsers);
            
            // Set today's date as default for expiry
            const today = new Date().toISOString().split('T')[0];
            expiryInput.value = today;
            
            // Try to load real users
            loadUsers();
        });

        // Load users from Firestore
        function loadUsers() {
            db.collection("users").onSnapshot((snapshot) => {
                allUsers = [];
                filteredUsers = [];
                
                let activeCount = 0;
                let inactiveCount = 0;
                
                snapshot.forEach(doc => {
                    const user = {
                        token: doc.id,
                        ...doc.data()
                    };
                    allUsers.push(user);
                    filteredUsers.push(user);
                    
                    if (user.isActive) {
                        activeCount++;
                    } else {
                        inactiveCount++;
                    }
                });
                
                // If no real users, show demo
                if (allUsers.length === 0) {
                    updateCounters(4, 3, 1);
                    renderDemoUsers();
                } else {
                    updateCounters(allUsers.length, activeCount, inactiveCount);
                    renderUsers();
                }
            }, (error) => {
                console.error("Error loading users:", error);
                // On error, show demo data
                updateCounters(4, 3, 1);
                renderDemoUsers();
                showNotification("‚ö†Ô∏è Using demo data", "info");
            });
        }

        // Update counters
        function updateCounters(total, active, inactive) {
            totalUsersEl.textContent = total;
            activeUsersEl.textContent = active;
            inactiveUsersEl.textContent = inactive;
        }

        // Render demo users (from your image)
        function renderDemoUsers() {
            usersList.innerHTML = demoUsers.map(user => `
                <div class="user-item ${user.isActive ? 'active' : 'inactive'}" 
                     data-token="${user.token}" 
                     onclick="fillForm('${user.token}')">
                    <div class="user-header-small">
                        <div class="user-name">${user.username}</div>
                        <div class="user-status-small ${user.isActive ? 'status-active-small' : 'status-inactive-small'}">
                            ${user.isActive ? 'ACTIVE' : 'INACTIVE'}
                        </div>
                    </div>
                    <div class="user-details-small">
                        <div class="detail-row">
                            <i class="fas fa-calendar-alt"></i>
                            <span class="detail-label">Expiry:</span>
                            <span class="detail-value">${user.expiryDate || 'null'}</span>
                        </div>
                        <div class="detail-row">
                            <i class="fas fa-clock"></i>
                            <span class="detail-label">Remaining:</span>
                            <span class="detail-value">${user.remainingDays}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Render real users
        function renderUsers() {
            if (filteredUsers.length === 0) {
                usersList.innerHTML = `
                    <div class="empty-state-small">
                        <i class="fas fa-users-slash"></i>
                        <h3>No Users Found</h3>
                        <p>Add your first user</p>
                    </div>
                `;
                return;
            }
            
            usersList.innerHTML = filteredUsers.map(user => {
                // Calculate remaining days
                let remainingDays = "Unknown";
                if (user.expiryDate) {
                    const expiry = new Date(user.expiryDate);
                    const today = new Date();
                    const diffTime = expiry - today;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    remainingDays = diffDays > 0 ? `${diffDays} days` : "Expired";
                }
                
                return `
                    <div class="user-item ${user.isActive ? 'active' : 'inactive'}" 
                         data-token="${user.token}" 
                         onclick="fillForm('${user.token}')">
                        <div class="user-header-small">
                            <div class="user-name">${user.username || user.token}</div>
                            <div class="user-status-small ${user.isActive ? 'status-active-small' : 'status-inactive-small'}">
                                ${user.isActive ? 'ACTIVE' : 'INACTIVE'}
                            </div>
                        </div>
                        <div class="user-details-small">
                            <div class="detail-row">
                                <i class="fas fa-calendar-alt"></i>
                                <span class="detail-label">Expiry:</span>
                                <span class="detail-value">${user.expiryDate || 'No date'}</span>
                            </div>
                            <div class="detail-row">
                                <i class="fas fa-clock"></i>
                                <span class="detail-label">Remaining:</span>
                                <span class="detail-value">${remainingDays}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Filter users based on search input
        function filterUsers() {
            const keyword = searchInput.value.toLowerCase().trim();
            
            if (keyword === '') {
                if (allUsers.length > 0) {
                    filteredUsers = [...allUsers];
                    renderUsers();
                } else {
                    filteredUsers = [...demoUsers];
                    renderDemoUsers();
                }
            } else {
                const source = allUsers.length > 0 ? allUsers : demoUsers;
                filteredUsers = source.filter(user => 
                    (user.token && user.token.toLowerCase().includes(keyword)) ||
                    (user.username && user.username.toLowerCase().includes(keyword))
                );
                
                if (allUsers.length > 0) {
                    renderUsers();
                } else {
                    usersList.innerHTML = filteredUsers.map(user => `
                        <div class="user-item ${user.isActive ? 'active' : 'inactive'}" 
                             data-token="${user.token}" 
                             onclick="fillForm('${user.token}')">
                            <div class="user-header-small">
                                <div class="user-name">${user.username}</div>
                                <div class="user-status-small ${user.isActive ? 'status-active-small' : 'status-inactive-small'}">
                                    ${user.isActive ? 'ACTIVE' : 'INACTIVE'}
                                </div>
                            </div>
                            <div class="user-details-small">
                                <div class="detail-row">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span class="detail-label">Expiry:</span>
                                    <span class="detail-value">${user.expiryDate || 'null'}</span>
                                </div>
                                <div class="detail-row">
                                    <i class="fas fa-clock"></i>
                                    <span class="detail-label">Remaining:</span>
                                    <span class="detail-value">${user.remainingDays}</span>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            }
        }

        // Form functions
        function openForm() {
            formOverlay.style.display = 'flex';
            clearForm();
        }

        function closeForm() {
            formOverlay.style.display = 'none';
            clearForm();
        }

        function clearForm() {
            tokenInput.value = '';
            tokenInput.disabled = false;
            usernameInput.value = '';
            expiryInput.value = new Date().toISOString().split('T')[0];
            isActiveInput.checked = true;
            currentEditToken = null;
        }

        // Fill form with user data for editing
        function fillForm(token) {
            let user;
            
            // Check in real users first
            if (allUsers.length > 0) {
                user = allUsers.find(u => u.token === token);
            } else {
                // Check in demo users
                user = demoUsers.find(u => u.token === token);
            }
            
            if (!user) return;
            
            tokenInput.value = user.token;
            tokenInput.disabled = true;
            usernameInput.value = user.username || '';
            expiryInput.value = user.expiryDate || '';
            isActiveInput.checked = user.isActive || false;
            currentEditToken = user.token;
            
            formOverlay.style.display = 'flex';
        }

        // CRUD Operations
        function addUser() {
            const token = tokenInput.value.trim();
            const username = usernameInput.value.trim();
            const expiryDate = expiryInput.value.trim();
            const isActive = isActiveInput.checked;
            
            if (!token) {
                showNotification("Token is required", "error");
                return;
            }
            
            const user = {
                username: username || token,
                expiryDate: expiryDate,
                isActive: isActive
            };
            
            db.collection("users").doc(token).set(user)
                .then(() => {
                    showNotification("‚úÖ User added successfully", "success");
                    closeForm();
                })
                .catch(error => {
                    showNotification("‚ùå Error adding user: " + error.message, "error");
                });
        }

        function updateUser() {
            const token = currentEditToken || tokenInput.value.trim();
            
            if (!token) {
                showNotification("Please select a user to update", "error");
                return;
            }
            
            const user = {
                username: usernameInput.value.trim(),
                expiryDate: expiryInput.value.trim(),
                isActive: isActiveInput.checked
            };
            
            db.collection("users").doc(token).set(user, { merge: true })
                .then(() => {
                    showNotification("‚úÖ User updated successfully", "success");
                    closeForm();
                })
                .catch(error => {
                    showNotification("‚ùå Error updating user: " + error.message, "error");
                });
        }

        function deleteUser() {
            const token = currentEditToken || tokenInput.value.trim();
            
            if (!token) {
                showNotification("Please select a user to delete", "error");
                return;
            }
            
            if (!confirm(`Are you sure you want to delete user "${token}"?`)) {
                return;
            }
            
            db.collection("users").doc(token).delete()
                .then(() => {
                    showNotification("üóëÔ∏è User deleted successfully", "success");
                    closeForm();
                })
                .catch(error => {
                    showNotification("‚ùå Error deleting user: " + error.message, "error");
                });
        }

        // Notification system
        function showNotification(message, type = "info") {
            const icon = type === 'success' ? 'fas fa-check-circle' : 
                        type === 'error' ? 'fas fa-exclamation-circle' : 
                        'fas fa-info-circle';
            
            notification.innerHTML = `
                <i class="${icon}"></i>
                <span>${message}</span>
            `;
            notification.className = `notification-small ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Make fillForm available globally for onclick events
        window.fillForm = fillForm;
    </script>
</body>
</html>
